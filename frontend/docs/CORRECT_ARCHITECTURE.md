# âœ… æ­£ç¡®çš„ä¸‰å±‚æ¶æ„

## ğŸ“‹ æ¶æ„åŸåˆ™

### **æ ¸å¿ƒåŸåˆ™ï¼šæŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†ï¼Œè€Œä¸æ˜¯æŒ‰èµ„æºåˆ’åˆ†**

- âœ… **auth.ts** - ç”¨æˆ·ç›¸å…³çš„æ‰€æœ‰åŠŸèƒ½ï¼ˆç™»å½•ã€æ³¨å†Œã€ç»Ÿè®¡ã€æ”¶è—ç­‰ï¼‰
- âœ… **dataset.ts** - æ•°æ®é›†èµ„æºæœ¬èº«çš„æ“ä½œï¼ˆCRUDã€åˆ—è¡¨ã€è¯¦æƒ…ç­‰ï¼‰
- âœ… **transaction.ts** - äº¤æ˜“ç›¸å…³åŠŸèƒ½

---

## ğŸ—ï¸ æ­£ç¡®çš„åˆ†å±‚ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Page å±‚ (UIå±‚)                      â”‚
â”‚         app/my-datasets/page.tsx                â”‚
â”‚                                                  â”‚
â”‚  èŒè´£ï¼š                                          â”‚
â”‚  - ç®¡ç†UIçŠ¶æ€                                    â”‚
â”‚  - å¤„ç†ç”¨æˆ·äº¤äº’                                  â”‚
â”‚  - æ•°æ®å±•ç¤º                                      â”‚
â”‚  - æ•°æ®æ ¼å¼è½¬æ¢                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“ import
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Context å±‚ (ä¸šåŠ¡é€»è¾‘å±‚)               â”‚
â”‚         contexts/AuthContext.tsx                â”‚
â”‚                                                  â”‚
â”‚  èŒè´£ï¼š                                          â”‚
â”‚  - å°è£…ä¸šåŠ¡é€»è¾‘                                  â”‚
â”‚  - æä¾›å¯å¤ç”¨çš„å‡½æ•°                              â”‚
â”‚  - ä½¿ç”¨ export å¯¼å‡ºï¼ˆä¸ç”¨ Contextï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“ import
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API å±‚ (æ•°æ®è®¿é—®å±‚)                 â”‚
â”‚                                                  â”‚
â”‚   lib/api/auth.ts    â”‚   lib/api/dataset.ts    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚   ç”¨æˆ·ç›¸å…³åŠŸèƒ½       â”‚   æ•°æ®é›†èµ„æºæ“ä½œ         â”‚
â”‚                                                  â”‚
â”‚  èŒè´£ï¼š                                          â”‚
â”‚  - HTTP è¯·æ±‚                                     â”‚
â”‚  - é”™è¯¯å¤„ç†                                      â”‚
â”‚  - æ•°æ®è¿”å›                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“ axios
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åç«¯ API                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‚ æ–‡ä»¶èŒè´£åˆ’åˆ†

### **1. `lib/api/auth.ts` - ç”¨æˆ·ç›¸å…³**

**åŒ…å«çš„åŠŸèƒ½ï¼š**
- âœ… ç™»å½•/æ³¨å†Œ/ç™»å‡º
- âœ… ç”¨æˆ·ä¿¡æ¯ç®¡ç†ï¼ˆæ›´æ–°èµ„æ–™ã€é‡ç½®å¯†ç ï¼‰
- âœ… é’±åŒ…ç®¡ç†ï¼ˆç»‘å®šé’±åŒ…ã€æ›´æ¢é’±åŒ…ï¼‰
- âœ… **ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯**ï¼ˆæ€»æ¶ˆè´¹ã€æ€»ä¸Šä¼ ã€æ€»è´­ä¹°ã€æ€»ä¸‹è½½ï¼‰
- âœ… **ä½œè€…æ•°æ®é›†ç»Ÿè®¡**ï¼ˆæ€»æ•°æ®é›†ã€æ€»ä¸‹è½½é‡ã€æ€»æ”¶ç›Šï¼‰â­
- âœ… ç”¨æˆ·æ”¶è—ç®¡ç†
- âœ… ç”¨æˆ·äº¤æ˜“è®°å½•
- âœ… ç”¨æˆ·ä¸‹è½½è®°å½•

**æ ¸å¿ƒå‡½æ•°ï¼š**
```typescript
// ç”¨æˆ·åŸºç¡€åŠŸèƒ½
export async function loginApi(...)
export async function registerApi(...)
export async function updateUserInfoApi(...)

// é’±åŒ…ç›¸å…³
export async function bindWalletApi(...)
export async function getWalletInfoApi(...)

// ç”¨æˆ·ç»Ÿè®¡ï¼ˆä¹°å®¶è§†è§’ï¼‰
export async function getUserStatsApi()

// ä½œè€…ç»Ÿè®¡ï¼ˆå–å®¶è§†è§’ï¼‰â­ 
export async function getAuthorDatasetStatsApi(authorWalletAddress: string)

// æ”¶è—ã€äº¤æ˜“ã€ä¸‹è½½è®°å½•
export async function getUserFavoritesApi(...)
export async function getUserTransactionsApi()
export async function getUserDownloadRecordsApi()
```

**ä¸ºä»€ä¹ˆç»Ÿè®¡ä¿¡æ¯åœ¨ auth.tsï¼Ÿ**
- âœ… ç»Ÿè®¡ä¿¡æ¯æ˜¯**ç”¨æˆ·çš„å±æ€§**ï¼Œå±äºç”¨æˆ·æ¨¡å—
- âœ… ç”¨æˆ·æœ‰ä¸¤ä¸ªè§’è‰²ï¼šä¹°å®¶ï¼ˆæ¶ˆè´¹ç»Ÿè®¡ï¼‰+ å–å®¶ï¼ˆé”€å”®ç»Ÿè®¡ï¼‰
- âœ… ç»Ÿè®¡ä¿¡æ¯ç”¨äº**ç”¨æˆ·ç›¸å…³é¡µé¢**ï¼ˆä¸ªäººä¸­å¿ƒã€æˆ‘çš„æ•°æ®é›†ï¼‰

---

### **2. `lib/api/dataset.ts` - æ•°æ®é›†èµ„æº**

**åŒ…å«çš„åŠŸèƒ½ï¼š**
- âœ… æ•°æ®é›† CRUDï¼ˆä¸Šä¼ ã€åˆ é™¤ã€æ›´æ–°ï¼‰
- âœ… æ•°æ®é›†åˆ—è¡¨æŸ¥è¯¢ï¼ˆç­›é€‰ã€åˆ†é¡µï¼‰
- âœ… **è·å–æŒ‡å®šä½œè€…çš„æ•°æ®é›†åˆ—è¡¨**â­
- âœ… æ•°æ®é›†è¯¦æƒ…
- âœ… æ•°æ®é›†ä¸‹è½½
- âœ… æ•°æ®é›†é¢„è§ˆ
- âœ… åˆ†ç‰‡ä¸Šä¼ 

**æ ¸å¿ƒå‡½æ•°ï¼š**
```typescript
// æ•°æ®é›† CRUD
export async function createDatasetApi(...)
export async function deleteDatasetAndFileApi(...)
export async function uploadPreviewData(...)

// æ•°æ®é›†æŸ¥è¯¢
export async function getFreeDatasets(...)
export async function getPaidDatasets(...)
export async function getDatasetById(...)

// è·å–ä½œè€…çš„æ•°æ®é›†åˆ—è¡¨ â­
export async function getDatasetsByAuthorApi(authorWalletAddress: string, page = 1, limit = 1000)

// æ•°æ®é›†ä¸‹è½½
export async function downloadFreeDataset(...)
export async function startPaidDownloadTask(...)

// åˆ†ç‰‡ä¸Šä¼ 
export async function initMultipartUpload(...)
export async function completeMultipartUpload(...)
```

**ä¸ºä»€ä¹ˆæ•°æ®é›†åˆ—è¡¨åœ¨ dataset.tsï¼Ÿ**
- âœ… è¿™æ˜¯å¯¹**æ•°æ®é›†èµ„æº**çš„æŸ¥è¯¢æ“ä½œ
- âœ… åªæ˜¯åŠ äº†ä¸€ä¸ªç­›é€‰æ¡ä»¶ï¼ˆauthor_wallet_addressï¼‰
- âœ… è¿”å›çš„æ˜¯æ•°æ®é›†åˆ—è¡¨ï¼Œä¸æ˜¯ç»Ÿè®¡ä¿¡æ¯

---

## ğŸ”„ å®Œæ•´çš„æ•°æ®æµ

### **åœºæ™¯ï¼šåŠ è½½"æˆ‘çš„æ•°æ®é›†"é¡µé¢**

```
1ï¸âƒ£ Page å±‚
   â†“
   const datasets = await getAuthorDatasets(walletAddress)
   const stats = await getAuthorDatasetStats(walletAddress)
   
2ï¸âƒ£ Context å±‚ (AuthContext.tsx)
   â†“
   getAuthorDatasets(walletAddress) {
     return getDatasetsByAuthorApi(walletAddress)  â† ä» dataset.ts å¯¼å…¥
   }
   
   getAuthorDatasetStats(walletAddress) {
     return getAuthorDatasetStatsApi(walletAddress)  â† ä» auth.ts å¯¼å…¥
   }
   
3ï¸âƒ£ API å±‚
   â†“
   ã€lib/api/dataset.tsã€‘
   getDatasetsByAuthorApi(walletAddress) {
     axios.get('/dataset/list?author_wallet_address=...')
   }
   
   ã€lib/api/auth.tsã€‘
   getAuthorDatasetStatsApi(walletAddress) {
     // å…ˆè·å–æ•°æ®é›†åˆ—è¡¨
     const datasets = axios.get('/dataset/list?author_wallet_address=...')
     // å†è®¡ç®—ç»Ÿè®¡æ•°æ®
     return { totalDatasets, totalDownloads, totalRevenue }
   }
```

---

## ğŸ“Š å¯¹æ¯”ï¼šé”™è¯¯ vs æ­£ç¡®

### **âŒ é”™è¯¯çš„æ¶æ„ï¼ˆä¹‹å‰ï¼‰**

```
lib/api/
  â”œâ”€â”€ auth.ts
  â”‚   â””â”€â”€ åªæœ‰ç™»å½•æ³¨å†Œç­‰åŸºç¡€åŠŸèƒ½
  â”‚
  â”œâ”€â”€ dataset.ts
  â”‚   â”œâ”€â”€ æ•°æ®é›† CRUD
  â”‚   â”œâ”€â”€ è·å–æ•°æ®é›†åˆ—è¡¨ âœ…
  â”‚   â””â”€â”€ è·å–ä½œè€…ç»Ÿè®¡ä¿¡æ¯ âŒ æ”¾é”™ä½ç½®äº†ï¼
```

**é—®é¢˜ï¼š**
- ç»Ÿè®¡ä¿¡æ¯å±äºç”¨æˆ·åŠŸèƒ½ï¼Œå´æ”¾åœ¨äº†æ•°æ®é›†æ¨¡å—
- ä¸ç¬¦åˆ"æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†"çš„åŸåˆ™

---

### **âœ… æ­£ç¡®çš„æ¶æ„ï¼ˆç°åœ¨ï¼‰**

```
lib/api/
  â”œâ”€â”€ auth.ts (ç”¨æˆ·æ¨¡å—)
  â”‚   â”œâ”€â”€ ç™»å½•/æ³¨å†Œ/ç™»å‡º
  â”‚   â”œâ”€â”€ ç”¨æˆ·ä¿¡æ¯ç®¡ç†
  â”‚   â”œâ”€â”€ é’±åŒ…ç®¡ç†
  â”‚   â”œâ”€â”€ ç”¨æˆ·ç»Ÿè®¡ï¼ˆä¹°å®¶ï¼‰ âœ…
  â”‚   â”œâ”€â”€ ä½œè€…ç»Ÿè®¡ï¼ˆå–å®¶ï¼‰ âœ…
  â”‚   â”œâ”€â”€ æ”¶è—/äº¤æ˜“/ä¸‹è½½è®°å½•
  â”‚
  â”œâ”€â”€ dataset.ts (æ•°æ®é›†æ¨¡å—)
  â”‚   â”œâ”€â”€ æ•°æ®é›† CRUD
  â”‚   â”œâ”€â”€ æ•°æ®é›†æŸ¥è¯¢ï¼ˆå«ä½œè€…ç­›é€‰ï¼‰ âœ…
  â”‚   â”œâ”€â”€ æ•°æ®é›†è¯¦æƒ…
  â”‚   â”œâ”€â”€ æ•°æ®é›†ä¸‹è½½
  â”‚   â””â”€â”€ åˆ†ç‰‡ä¸Šä¼ 
```

**ä¼˜ç‚¹ï¼š**
- âœ… èŒè´£æ¸…æ™°ï¼šç”¨æˆ·ç›¸å…³çš„éƒ½åœ¨ authï¼Œèµ„æºæ“ä½œéƒ½åœ¨ dataset
- âœ… æ˜“äºç»´æŠ¤ï¼šæ‰¾åŠŸèƒ½æ—¶çŸ¥é“å»å“ªä¸ªæ–‡ä»¶
- âœ… ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™

---

## ğŸ¯ åˆ¤æ–­æ ‡å‡†ï¼šåŠŸèƒ½åº”è¯¥æ”¾åœ¨å“ªä¸ªæ–‡ä»¶ï¼Ÿ

### **æ”¾åœ¨ `auth.ts` çš„æƒ…å†µï¼š**

â“ **è¿™ä¸ªåŠŸèƒ½æ˜¯å…³äºç”¨æˆ·çš„å—ï¼Ÿ**
- æ˜¯ç”¨æˆ·çš„å±æ€§å—ï¼Ÿ
- æ˜¯ç”¨æˆ·çš„è¡Œä¸ºå—ï¼Ÿ
- æ˜¯ç”¨æˆ·çš„ç»Ÿè®¡å—ï¼Ÿ

å¦‚æœç­”æ¡ˆæ˜¯ **æ˜¯**ï¼Œæ”¾åœ¨ `auth.ts`

**ç¤ºä¾‹ï¼š**
- âœ… ç”¨æˆ·ç™»å½• â†’ auth.ts
- âœ… ç”¨æˆ·æ€»æ¶ˆè´¹ â†’ auth.ts
- âœ… ä½œè€…æ€»æ”¶ç›Š â†’ auth.tsï¼ˆä½œè€…ä¹Ÿæ˜¯ç”¨æˆ·ï¼‰
- âœ… ç”¨æˆ·æ”¶è—åˆ—è¡¨ â†’ auth.ts

---

### **æ”¾åœ¨ `dataset.ts` çš„æƒ…å†µï¼š**

â“ **è¿™ä¸ªåŠŸèƒ½æ˜¯å…³äºæ•°æ®é›†èµ„æºçš„å—ï¼Ÿ**
- æ˜¯å¯¹æ•°æ®é›†çš„æ“ä½œå—ï¼Ÿ
- æ˜¯æŸ¥è¯¢æ•°æ®é›†åˆ—è¡¨å—ï¼Ÿ
- æ˜¯æ•°æ®é›†çš„è¯¦æƒ…å—ï¼Ÿ

å¦‚æœç­”æ¡ˆæ˜¯ **æ˜¯**ï¼Œæ”¾åœ¨ `dataset.ts`

**ç¤ºä¾‹ï¼š**
- âœ… ä¸Šä¼ æ•°æ®é›† â†’ dataset.ts
- âœ… æŸ¥è¯¢æ•°æ®é›†åˆ—è¡¨ â†’ dataset.ts
- âœ… è·å–æŸä½œè€…çš„æ•°æ®é›† â†’ dataset.tsï¼ˆåªæ˜¯å¤šäº†ä¸ªç­›é€‰æ¡ä»¶ï¼‰
- âœ… ä¸‹è½½æ•°æ®é›† â†’ dataset.ts

---

### **ç‰¹æ®Šæƒ…å†µï¼šæ—¢æ¶‰åŠç”¨æˆ·åˆæ¶‰åŠæ•°æ®é›†**

**åŸåˆ™ï¼šçœ‹ä¸»è¦ç›®çš„**

| åŠŸèƒ½ | ä¸»è¦ç›®çš„ | åº”è¯¥æ”¾åœ¨ |
|------|---------|---------|
| è·å–æŸä½œè€…çš„æ•°æ®é›†åˆ—è¡¨ | æŸ¥è¯¢æ•°æ®é›† | dataset.ts |
| è®¡ç®—ä½œè€…çš„é”€å”®ç»Ÿè®¡ | ç”¨æˆ·ç»Ÿè®¡ | auth.ts |
| ç”¨æˆ·æ”¶è—æŸæ•°æ®é›† | ç”¨æˆ·è¡Œä¸º | auth.ts |
| ç”¨æˆ·ä¸‹è½½æŸæ•°æ®é›† | æ•°æ®é›†æ“ä½œ | dataset.ts |

---

## ğŸ“ ä¿®æ”¹æ€»ç»“

### **ä¿®æ”¹å†…å®¹ï¼š**

1. âœ… **ä» `dataset.ts` åˆ é™¤äº†**
   ```typescript
   - export async function getAuthorDatasetStatsApi(...)
   ```

2. âœ… **æ·»åŠ åˆ° `auth.ts`**
   ```typescript
   + export async function getAuthorDatasetStatsApi(authorWalletAddress: string)
   ```

3. âœ… **ä¿ç•™åœ¨ `dataset.ts`**
   ```typescript
   âœ… export async function getDatasetsByAuthorApi(authorWalletAddress: string)
   ```

4. âœ… **æ›´æ–° `AuthContext.tsx` çš„å¯¼å…¥è·¯å¾„**
   ```typescript
   // ä¿®æ”¹å‰
   - const { getAuthorDatasetStatsApi } = await import('@/lib/api/dataset');
   
   // ä¿®æ”¹å
   + const { getAuthorDatasetStatsApi } = await import('@/lib/api/auth');
   ```

---

## ğŸ‰ æ€»ç»“

### **æ­£ç¡®çš„ä¸‰å±‚æ¶æ„ï¼š**

```
Page.tsx (UIå±‚)
    â†“ import
AuthContext.tsx (ä¸šåŠ¡é€»è¾‘å±‚)
    â†“ import
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  auth.ts       â”‚  dataset.ts    â”‚  (æ•°æ®è®¿é—®å±‚)
â”‚  ç”¨æˆ·ç›¸å…³      â”‚  èµ„æºæ“ä½œ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **å…³é”®åŸåˆ™ï¼š**
1. âœ… **æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†**ï¼Œä¸æ˜¯æŒ‰èµ„æºç±»å‹
2. âœ… **ç»Ÿè®¡ä¿¡æ¯æ˜¯ç”¨æˆ·å±æ€§**ï¼Œæ”¾åœ¨ auth.ts
3. âœ… **æ•°æ®é›†æŸ¥è¯¢æ˜¯èµ„æºæ“ä½œ**ï¼Œæ”¾åœ¨ dataset.ts
4. âœ… **æ¯å±‚åªåšè¯¥å±‚åº”è¯¥åšçš„äº‹**

**ç°åœ¨çš„æ¶æ„æ˜¯æ­£ç¡®çš„ï¼** ğŸš€

